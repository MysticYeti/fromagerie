<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Gare à Mots — Learn French</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#ce0f69">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<style>
  html,body{margin:0;height:100%;background:#fff9f0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  canvas{display:block;width:100vw;height:100vh;background:#fff9f0}
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
// ===== Canvas setup =====
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let DPR = Math.min(2, window.devicePixelRatio || 1);
function CW(){ return canvas.width / DPR; }
function CH(){ return canvas.height / DPR; }
function resize(){ DPR = Math.min(2, window.devicePixelRatio || 1);
  canvas.width = Math.floor(innerWidth*DPR); canvas.height = Math.floor(innerHeight*DPR);
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
addEventListener('resize', resize); resize();

// ===== Colors =====
const APP_NAME = 'Gare à Mots';
const COLORS = {
  primary:'#1e2a36',
  accent:'#ce0f69',
  accent2:'#ff6a00',
  steel:'#8a949e',
  concrete:'#f3f5f7',
  paper:'#fff9f0',
  ink:'#1e2a36',
  green:'#3dbb6b',
  red:'#ef233c'
};

// ===== UI Helpers =====
function roundRect(x,y,w,h,r,fill,stroke){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  if(fill){ctx.fillStyle=fill;ctx.fill()}
  if(stroke){ctx.strokeStyle=stroke;ctx.lineWidth=4;ctx.stroke()}
}
function button(text,x,y,w,h,fill=COLORS.accent,fg='#fff'){
  roundRect(x,y,w,h,18,fill,'#00000020');
  ctx.fillStyle=fg; ctx.font='bold 26px system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText(text, x+w/2, y+h/2);
  return {x,y,w,h};
}
function drawBadge(x,y,label,value){
  roundRect(x,y,180,70,14,'#ffffffd8','#00000010');
  ctx.fillStyle=COLORS.ink; ctx.font='bold 18px system-ui'; ctx.textAlign='left';
  ctx.fillText(label, x+16, y+26);
  ctx.fillStyle=COLORS.primary; ctx.font='bold 28px system-ui';
  ctx.fillText(value, x+16, y+54);
}

// ===== Progress storage =====
const LS='gare_a_mots_progress_v1';
function loadProg(){ const d=JSON.parse(localStorage.getItem(LS)||'{}'); const today=new Date().toISOString().slice(0,10);
  if(d.last!==today){ const y=new Date(); y.setDate(new Date().getDate()-1); const ys=y.toISOString().slice(0,10);
    d.streak=(d.last===ys)?(d.streak||0)+1:(d.streak||0); d.last=today; d.todayLearned=0; d.todayPlayed=0; }
  d.learned=d.learned||0; d.games=d.games||0; d.words=d.words||{}; return d;
}
let PROG=loadProg(); function saveProg(){ localStorage.setItem(LS,JSON.stringify(PROG)); }

// ===== Menu =====
let route='menu', buttons=[];
function drawMenu(){
  drawHeader();
  buttons=[];
  drawBadge(40,240,'Daily streak', PROG.streak+' 🔥');
  drawBadge(240,240,'Words learned', PROG.learned);
  drawBadge(440,240,'Games played', PROG.games);

  buttons.push( button('🐭 Mouse & Cheese (Game)', CW()/2-260, 340, 520, 70, COLORS.green) ); buttons[buttons.length-1].route='game';
  buttons.push( button('🗂 Flashcards', CW()/2-260, 430, 520, 70, COLORS.accent) ); buttons[buttons.length-1].route='flash';
  buttons.push( button('📝 Quiz', CW()/2-260, 520, 520, 70, COLORS.accent2) ); buttons[buttons.length-1].route='quiz';
  buttons.push( button('📈 Progress', CW()/2-260, 610, 520, 70, COLORS.steel, '#fff') ); buttons[buttons.length-1].route='progress';

  // Install bottom-left
  if (canInstall && !isStandalone()) {
    const ib = button('⬇ Install app', 30, CH()-70, 220, 50, '#ffffff', COLORS.ink);
    ib.onClick = async () => { if(!deferredPrompt) return; deferredPrompt.prompt(); const {outcome}=await deferredPrompt.userChoice; if(outcome==='accepted'){ canInstall=false; deferredPrompt=null; } };
    buttons.push(ib);
  } else if (isiOS() && !isStandalone()) {
    ctx.fillStyle = '#00000080'; ctx.font='14px system-ui'; ctx.textAlign='left';
    ctx.fillText('On iPhone/iPad: Share ▸ Add to Home Screen', 30, CH()-30);
  }
}

// ===== Railway Background =====
function drawHeader(){
  const w=CW(); const seg=w/10;
  ctx.fillStyle=COLORS.paper; ctx.fillRect(0,0,w,CH());
  for(let i=0;i<10;i++){ ctx.fillStyle= i%3===0? COLORS.accent : (i%3===1? COLORS.accent2 : '#fed766'); ctx.fillRect(i*seg,0,seg,74); }
  ctx.fillStyle=COLORS.primary; ctx.font='bold 54px system-ui'; ctx.textAlign='center'; ctx.fillText(`${APP_NAME} — Learn French`, w/2, 150);
}

// ===== PWA Install Logic =====
let deferredPrompt=null, canInstall=false;
function isStandalone(){ return matchMedia('(display-mode: standalone)').matches || navigator.standalone===true; }
function isiOS(){ return /iphone|ipad|ipod/i.test(navigator.userAgent); }
if('serviceWorker' in navigator){ addEventListener('load',()=>{ navigator.serviceWorker.register('sw.js').catch(console.error); }); }
addEventListener('beforeinstallprompt',e=>{ e.preventDefault(); deferredPrompt=e; if(!isStandalone()) canInstall=true; });

// ===== Main Loop =====
function loop(){
  ctx.clearRect(0,0,CW(),CH());
  if(route==='menu') drawMenu();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
